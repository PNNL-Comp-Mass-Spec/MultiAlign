<Window x:Class="MultiAlignRogue.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:multiAlignRogue="clr-namespace:MultiAlignRogue"
        xmlns:utils="clr-namespace:MultiAlignRogue.Utils"
        xmlns:featureFinding="clr-namespace:MultiAlignRogue.Feature_Finding"
        Title="{Binding WindowTitle}" Height="600" Width="1100" x:Name="RogueMainWindow">
    <Window.DataContext>
        <multiAlignRogue:MainViewModel/>
    </Window.DataContext>
    <Window.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </Window.Resources>
    <Window.InputBindings>
        <KeyBinding Key="S" Modifiers="Control" Command="{Binding SaveProjectCommand}" />
    </Window.InputBindings>

    <Grid Name ="MainGrid">
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="475" />
        </Grid.ColumnDefinitions>
        <Menu Grid.ColumnSpan="2" HorizontalAlignment="Left" Height="20" VerticalAlignment="Top" Width="{Binding ElementName=MainGrid,Path=ActualWidth}">
            <MenuItem Header="File">
                <MenuItem Header="New Project" Command="{Binding CreateNewProjectCommand}" />
                <MenuItem Header="Load Project" HorizontalAlignment="Left" Width="168" Command="{Binding LoadProjectCommand}" />
                <MenuItem Header="Open Dataset" Command="{Binding SelectFilesCommand}">
                    <MenuItem Header="Select Files" HorizontalAlignment="Left" Width="168" Margin="0,0,-8,0" Command="{Binding SelectFilesCommand}"/>
                    <MenuItem Header="Select Directory" Command="{Binding SelectDirectoryCommand}" />
                    <MenuItem Header="From DMS" Command="{Binding SearchDmsCommand}" Visibility="{Binding ShowOpenFromDms, Converter={StaticResource BoolToVis}}" />
                </MenuItem>
                <Separator />
                <MenuItem Header="Save Project" HorizontalAlignment="Left" Command="{Binding SaveProjectCommand}"  Width="168"/>
                <MenuItem Header="Save Project As" Command="{Binding SaveAsProjectCommand}" />
            </MenuItem>
        </Menu>
        <!--<ProgressBar HorizontalAlignment="Right" Margin="0,0,10,19" Width="90" Height="20" VerticalAlignment="Bottom" Value="{Binding ProgressTracker, Mode = OneWay}"/> -->
        <DataGrid Name="FileSelectionDataGrid" Grid.Column="0" HorizontalAlignment="Stretch" Margin="10,55,10,10"
                  AutoGenerateColumns="False" CanUserReorderColumns="False" CanUserAddRows="False" 
                  ItemsSource="{Binding Datasets, UpdateSourceTrigger=PropertyChanged}" SelectionChanged="DataGrid_SelectionChanged">
            <DataGrid.Columns>
                <DataGridTemplateColumn Width="25">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Content="-" Command="{Binding RequestRemovalCommand}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn Header="File Name" Width="*">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Grid>
                                <ProgressBar Value="{Binding Progress}" />
                                <TextBlock HorizontalAlignment="Center" VerticalAlignment="Center" Text="{Binding Dataset.DatasetName}" />
                            </Grid>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridCheckBoxColumn Header="Scans" Width="45" IsReadOnly="True" Binding="{Binding ScansBool}" />
                <DataGridCheckBoxColumn Header="Raw" Width="40" IsReadOnly="True" Binding="{Binding RawBool}"/>
                <DataGridCheckBoxColumn Header="Features" Width="60" IsReadOnly="True" Binding="{Binding FeaturesFound, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <DataGridCheckBoxColumn.CellStyle>
                        <Style TargetType="{x:Type DataGridCell}">
                            <Setter Property="Background" Value="{Binding FindingFeatureLabelColor, UpdateSourceTrigger=PropertyChanged}" />
                        </Style>
                    </DataGridCheckBoxColumn.CellStyle>
                </DataGridCheckBoxColumn>
                <DataGridCheckBoxColumn Header="Aligned" Width="60" IsReadOnly="True" Binding="{Binding IsAligned, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <DataGridCheckBoxColumn.CellStyle>
                        <Style TargetType="{x:Type DataGridCell}">
                            <Setter Property="Background" Value="{Binding AligningLabelColor, UpdateSourceTrigger=PropertyChanged}" />
                        </Style>
                    </DataGridCheckBoxColumn.CellStyle>
                </DataGridCheckBoxColumn>
                <DataGridCheckBoxColumn Header="Clustered" Width="60" IsReadOnly="True" Binding="{Binding IsClustered, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                    <DataGridCheckBoxColumn.CellStyle>
                        <Style TargetType="{x:Type DataGridCell}">
                            <Setter Property="Background" Value="{Binding ClusterLabelColor, UpdateSourceTrigger=PropertyChanged}" />
                        </Style>
                    </DataGridCheckBoxColumn.CellStyle>
                </DataGridCheckBoxColumn>
            </DataGrid.Columns>
        </DataGrid>

        <TabControl Grid.Column="1" Margin="10,25,10,10">
            <TabItem Header="1. Feature Finding" Height="23" VerticalAlignment="Bottom" DataContext="{Binding FeatureFindingSettingsViewModel, UpdateSourceTrigger=PropertyChanged}">
                <featureFinding:FeatureFindingSettings Margin="5" />
            </TabItem>
            <TabItem Header="2. Alignment" HorizontalAlignment="Left" DataContext="{Binding AlignmentSettingsViewModel, UpdateSourceTrigger=PropertyChanged}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="22*"/>
                        <ColumnDefinition Width="51*"/>
                    </Grid.ColumnDefinitions>
                    <RadioButton Name="SelectBaseline" GroupName="ShouldAlignToBaseline" IsChecked="{Binding ShouldAlignToBaseline}" Margin="12,32,102,0" ToolTip="Align to a Baseline Dataset" Height="14" VerticalAlignment="Top"/>
                    <RadioButton Name="SelectAMT" GroupName="ShouldAlignToBaseline" IsChecked="{Binding ShouldAlignToAMT}" Margin="10,88,103,0" ToolTip="Align to an AMT Tag Database" Height="14" VerticalAlignment="Top"/>
                    <Label Content="Baseline" Margin="39,0,188,0" Grid.Column="1" Height="24" VerticalAlignment="Top"/>
                    <ComboBox Margin="37,24,10,0" Grid.ColumnSpan="2" DisplayMemberPath="Dataset.DatasetName" 
                              ItemsSource="{Binding DataContext.Datasets, ElementName=RogueMainWindow}"
                              SelectedItem="{Binding SelectedBaseline, Mode=TwoWay}" Height="22" VerticalAlignment="Top" 
                              IsEnabled="{Binding ShouldAlignToBaseline, UpdateSourceTrigger=PropertyChanged}"/>

                    <TextBox Grid.ColumnSpan="2" HorizontalAlignment="Left" Height="25" Margin="37,82,0,0" TextWrapping="Wrap" IsReadOnly="True" IsEnabled="{Binding ShouldAlignToAMT, UpdateSourceTrigger=PropertyChanged}"
                             Text="{Binding SelectedDatabaseServer.DatabaseName, UpdateSourceTrigger=PropertyChanged, Mode=TwoWay, NotifyOnSourceUpdated=True}" VerticalAlignment="Top" Width="292"/>
                    <Label Content="AMT Tag Database" Margin="24,54,174,0" Grid.Column="1" Height="28" VerticalAlignment="Top"/>
                    <Button Content="Select Database" Command="{Binding SelectAMTCommand}" Grid.Column="1" HorizontalAlignment="Left" Height="25" Margin="200,81,0,0" VerticalAlignment="Top" Width="97"/>

                    <Label Content="Tolerances" HorizontalAlignment="Left" Height="24" Margin="10,186,0,0" VerticalAlignment="Top" Width="77" FontWeight="Bold"/>
                    <Label Content="Mass Tolerance" VerticalContentAlignment="Top"  HorizontalAlignment="Left" Height="28" Margin="11,208,0,0" VerticalAlignment="Top" Width="168" Grid.ColumnSpan="2"/>
                    <TextBox HorizontalContentAlignment="Center" Height="19" Margin="117,211,0,0" TextWrapping="Wrap" VerticalAlignment="Top" 
                             Text="{Binding MassTolerance, Mode=TwoWay, NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged}" Grid.ColumnSpan="2" HorizontalAlignment="Left" Width="60"/>
                    <Label Content="NET Tolerance" VerticalContentAlignment="Top"  HorizontalAlignment="Left" Height="28" Margin="11,228,0,0" VerticalAlignment="Top" Width="168" Grid.ColumnSpan="2"/>
                    <TextBox HorizontalContentAlignment="Center" Height="19" Margin="117,232,0,0" TextWrapping="Wrap" VerticalAlignment="Top" 
                             Text="{Binding NetTolerance, Mode=TwoWay, NotifyOnSourceUpdated=True, UpdateSourceTrigger=PropertyChanged}" Grid.ColumnSpan="2" HorizontalAlignment="Left" Width="60"/>
                    <Label Content="Alignment Algorithm" HorizontalContentAlignment="Left" Margin="151,186,5,0" FontWeight="Bold" Grid.Column="1" Height="28" VerticalAlignment="Top"/>
                    <ComboBox Margin="142,215,14,0" Grid.Column="1" SelectedItem="{Binding SelectedAlignmentAlgorithm}"
                              ItemsSource="{Binding AlignmentAlgorithms, UpdateSourceTrigger=PropertyChanged}" Height="22" VerticalAlignment="Top"/>
                    <Label Content="Calibration Method" HorizontalContentAlignment="Left" Margin="150,236,6,0" FontWeight="Bold" Grid.Column="1" Height="28" VerticalAlignment="Top"/>
                    <ComboBox Margin="142,265,14,0" Grid.Column="1" SelectedItem="{Binding SelectedCalibrationType}"
                              ItemsSource="{Binding CalibrationOptions}" Height="22" VerticalAlignment="Top"/>
                    <Button Content="Align Datasets" HorizontalAlignment="Left" Margin="12,0,0,10" Width="110" Command="{Binding AlignCommand}" Height="24" VerticalAlignment="Bottom"/>
                    <Button Content="Display Alignment" Grid.Column="1" Margin="0,0,14,10" Command="{Binding DisplayAlignmentCommand}" HorizontalAlignment="Right" Width="108" Height="24" VerticalAlignment="Bottom"/>


                </Grid>
            </TabItem>
            <TabItem Header="3. Clustering" DataContext="{Binding ClusterSettingsViewModel}">
                <Grid>
                    <Label Content="Clustering Method" HorizontalContentAlignment="Left" Height="28" VerticalAlignment="Top" Margin="10,11,0,0" Width="150" HorizontalAlignment="Left" FontWeight="Bold"/>
                    <ComboBox Margin="10,37,278,0" SelectedItem="{Binding SelectedLcmsFeatureClusteringAlgorithm}"
                              ItemsSource="{Binding ClusteringMethods}" Height="22" VerticalAlignment="Top"/>
                    <Label Content="Distance Function" Margin="10,62,298,0" FontWeight="Bold" Height="26" VerticalAlignment="Top"/>
                    <ComboBox Margin="10,88,278,0" SelectedItem="{Binding SelectedDistanceFunction}" ItemsSource="{Binding DistanceMetrics}" Height="22" VerticalAlignment="Top"/>
                    <Label Content="Centroid Representation" Margin="275,11,13,0" FontWeight="Bold" Height="26" VerticalAlignment="Top"/>
                    <ComboBox Margin="275,37,13,0" SelectedItem="{Binding SelectedCentroidMethod}" ItemsSource="{Binding CentroidRepresentations}" Height="22" VerticalAlignment="Top"/>
                    <CheckBox Content="Separate by Charge" Margin="275,75,25,0" FontWeight="Bold" Height="22" VerticalAlignment="Top" 
                              IsChecked="{Binding ShouldSeparateByCharge, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"/>
                    <Button Content="Cluster Features" Margin="12,0,323,10" Height="24" Command="{Binding ClusterFeaturesCommand}" VerticalAlignment="Bottom"/>
                    <Button Content="View Clusters" Margin="322,0,13,10" Height="24" Command="{Binding DisplayClustersCommand}" VerticalAlignment="Bottom"/>
                </Grid>
            </TabItem>
        </TabControl>
        <Label Content="Working Data Files" HorizontalContentAlignment="Left" Height="28" Margin="10,25,0,0" VerticalAlignment="Top" Width="211" HorizontalAlignment="Left" FontSize="14"/>
        <!--<TextBox HorizontalAlignment="Left" Margin="10,0,0,19" Text="{Binding InputFilePath, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" TextWrapping="Wrap" Width="275" Height="22" VerticalAlignment="Bottom">
            <TextBox.InputBindings>
                <KeyBinding Command="{Binding AddFolderCommand}" Key="Enter" />
            </TextBox.InputBindings>
        </TextBox>

        <Button Content="Browse" HorizontalAlignment="Left" VerticalAlignment="Bottom" Width="50" Height="22" Margin="290,0,0,19" Command="{Binding SelectDirectoryCommand}"></Button>
        <Button Content="Add" HorizontalAlignment="Left" Margin="344,0,0,19" Width="50" Height="22" VerticalAlignment="Bottom" Command="{Binding AddFolderCommand}"/> -->

    </Grid>
</Window>
